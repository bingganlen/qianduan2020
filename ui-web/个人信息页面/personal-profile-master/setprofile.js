define(function(require){require("common"),require("/static/component/base/placeholder/placeholder.js"),require("/static/component/base/util/validate_v2.js");var a=(require("/static/page/user/messagebox.js"),require("/static/page/user/common/settingUitl.js"),function(){var m={};return{set:function(t,a){m.xhr&&m.xhr.abort(),m.type=t,a&&(m.xhr=a)},is:function(t){return m.type===t},get:function(){return m.type}}}()),c=function(){var a;return a=$(".avator-img"),function(c){a.attr("data-portrait",c.imgname),a.attr("src",c.imgpath)}}();$(document).on("logined.sns",function(e){$("#avator-btns").find('[data-sns="'+a.get()+'"]').trigger("click").siblings(".avator-sns-relogintip").remove(),e.preventDefault()}),$(document).on("click",".avator-btn-fake",function(){$("#upload").click()});$(document).on("click","[data-sns]",function(){var g=$(this),v=g.attr("data-sns");a.set(v),$.ajax({url:"/user/getimage?type="+v+"_sid",dataType:"json",success:function(g){a.is(v)&&(1==g.result?c(g.data):$.alert("error",{info:g.msg}))},error:function(){$.alert("error",{info:"后端请求失败,请稍后重试！"})}})}),$(function(){var a=128-$(".js-sign").val().length;a>=0?$(".js-numCanInput").html("还可以输入"+a+"个字符"):(a=0-a,$(".js-numCanInput").html('已超出<span class="color-red">'+a+"</span>个字符"))}),$(document).delegate(".js-sign","change",function(){var a=128-$(".js-sign").val().length;a>=0?$(".js-numCanInput").html("还可以输入"+a+"个字符"):(a=0-a,$(".js-numCanInput").html('已超出<span class="color-red">'+a+"</span>个字符"))}),$(document).delegate(".js-sign","keyup",function(){var a=128-$(".js-sign").val().length;a>=0?$(".js-numCanInput").html("还可以输入"+a+"个字符"):(a=0-a,$(".js-numCanInput").html('已超出<span class="color-red">'+a+"</span>个字符"))}),$(document).delegate(".js-sign","keydown",function(){var a=128-$(".js-sign").val().length;a>=0?$(".js-numCanInput").html("还可以输入"+a+"个字符"):(a=0-a,$(".js-numCanInput").html('已超出<span class="color-red">'+a+"</span>个字符"))}),!function(){$("#upload").on("change",function(){this.value&&(a.set("local"),this.form.submit())}),$("#uploadtarget").on("load",function(){if(a.is("local")){var g=$("#uploadtarget").contents().find("body").text();if(g=$.parseJSON(g),null==g.data)return void $("#js-portrait").siblings(".rlf-tip-wrap").append(g.msg);$("#js-portrait").siblings(".rlf-tip-wrap").empty();var v={};v.imgname=g.data.key,v.imgpath=g.data.imgpath,c(v)}})}(),$(".js-avator-try").click(function(){a.set("try"),$.getJSON("/user/randimage/","type=1",function($){a.is("try")&&$&&c($)})}),$("#province-select").change(function(){$("#city-select").text("").append("<option value='0'>选择城市 </option>"),$("#area-select").text("").append("<option value='0'>选择区县 </option>"),$.get("/user/ajaxchangeprov","id="+$(this).val(),function(a){if(a&&1==a.result)for(var c=$("#city-select"),d=a.data,g=d.length,i=0;g>i;i++)c.append("<option value="+d[i].id+" >"+d[i].name+" </option>")},"json")}),$("#city-select").change(function(){$("#area-select").text("").append("<option value='0'>选择区县 </option>"),$.get("/user/ajaxchangecity","id="+$(this).val(),function(a){if(a&&1==a.result)for(var c=$("#area-select"),d=a.data,g=d.length,i=0;g>i;i++)c.append("<option value="+d[i].id+" >"+d[i].name+" </option>")},"json")}),$("#profile-submit").click(function(){var a=128-$(".js-sign").val().length;if(a>=0){var c,g=$(this);if("正在保存..."!=g.text())if(g.text("正在保存..."),c=g.closest("form"),W.validate()){var v={type:1};v.job=$("#job").val(),v.sex=$("#profile input[name='sex']:checked").val(),v.portrait=$("#js-portrait").attr("data-portrait"),v.nickname=$("#nick").val(),v.about=$("#aboutme").val(),v.province=$("#province-select").val(),v.city=$("#city-select").val(),v.area=$("#area-select").val(),$.ajax({url:"/user/ajaxsetinfo",data:v,method:"post",dataType:"json",success:function(a){1==a.result?window.location.reload():$.alert("error",{info:a.msg}),g.text("保存")},error:function(){$.alert("error",{info:"修改失败！"}),g.text("保存")}})}else g.text("保存")}})});